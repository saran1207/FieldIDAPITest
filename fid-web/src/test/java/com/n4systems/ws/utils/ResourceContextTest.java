package com.n4systems.ws.utils;

import com.n4systems.model.Tenant;
import com.n4systems.ws.handlers.TenantLoadHandler;
import org.easymock.EasyMock;
import org.junit.Test;

import javax.ws.rs.core.UriInfo;
import java.net.URI;

import static org.junit.Assert.*;

public class ResourceContextTest {

	@Test
	public void sets_security_fields() {
		URI reqUri = URI.create("http://www.google.com");
		Tenant tenant = new Tenant(10L, "O Hai");
		
		UriInfo uriInfo = EasyMock.createMock(UriInfo.class);
		EasyMock.expect(uriInfo.getRequestUri()).andReturn(reqUri);
		EasyMock.replay(uriInfo);
		
		TenantLoadHandler handler = EasyMock.createMock(TenantLoadHandler.class);
		EasyMock.expect(handler.getTenant(reqUri)).andReturn(tenant);
		EasyMock.replay(handler);
		
		ResourceContext context = new ResourceContext(handler, uriInfo);
		
		EasyMock.verify(uriInfo);
		EasyMock.verify(handler);
		
		assertSame(uriInfo, context.getUriInfo());
		assertSame(tenant, context.getTenant());
		assertEquals(tenant.getId(), context.getSecurityFilter().getTenantId());
		assertNotNull(context.getLoaderFactory());
	}
	
}
