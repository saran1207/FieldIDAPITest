<wicket:head>
<script type="text/javascript">
// TODO DD : make this javascript be generated by java class.
var options = {
        lines: { show: true },
        points: { show: true },
        selection: { mode: "x" },
        yaxis : { 
        	decimals: "0"
        },
        xaxis: { 
        	mode: "time",
			timeformat : "%b %0d, %y",			
			monthNames : ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"]
        	},
        grid: { hoverable: true, clickable: true }
    };	


// TODO DD : refactor into shared "chart.js" file.
function bindHover() {
	$("#graph").bind("plothover", function (event, pos, item) {
	    $("#x").text(pos.x.toFixed(2));
	    $("#y").text(pos.y.toFixed(2));

	        if (item) {
	            if (previousPoint != item.datapoint) {
	                previousPoint = item.datapoint;
	                
	                $("#tooltip").remove();
	                var y = item.datapoint[1].toFixed(options.yaxis.decimals);
	                var date = formatDate(new Date(item.datapoint[0]));
	                showTooltip(item.pageX, item.pageY,  date + "<br>" + y);
	            }
	        }
	        else {
	            $("#tooltip").remove();
	            clicksYet = false;
	            previousPoint = null;            
	        }
		});
}

function formatDate(d) { 
	var day = d.getDate();
	var month = d.getMonth();
	var year = d.getFullYear();
	// format into quarters.	
	return options.xaxis.monthNames[month] + ' ' + day + ' ' + year; 
}

function updateGraph(newData) {
	var d1 = [{data:newData, label:"Assets Identified"}];	
    $.plot($("#graph"), d1, options);
    bindHover();
}

function showTooltip(x, y, contents) {
    $('<div id="tooltip">' + contents + '</div>').css( {
        position: 'absolute',
        display: 'none',
        top: y + 5,
        left: x + 5,        
        border: '1px solid #fdd',
        'text-align': 'center',
        padding: '2px',
        'background-color': '#fee',
        opacity: 0.80
    }).appendTo("body").fadeIn(200);
}

var previousPoint = null;

</script>
</wicket:head>

<wicket:panel>
	<!-- FIXME DD : take out hard coded height styling -->
	<div wicket:id="graph" style="height:300px;"/>	  
</wicket:panel>