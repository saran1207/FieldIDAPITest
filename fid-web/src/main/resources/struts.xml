<!DOCTYPE struts PUBLIC
    "-//Apache Software Foundation//DTD Struts Configuration 2.0//EN"
    "http://struts.apache.org/dtds/struts-2.0.dtd">

<struts><!-- Configuration for the default package. -->

	<constant name="struts.objectFactory" value="spring" />
	<constant name="struts.ui.theme" value="css_xhtml" />
	<constant name="struts.url.includeParams" value="none" />
	<constant name="struts.multipart.maxSize" value="10000000" />
	<constant name="struts.multipart.saveDir" value="/var/fieldid/tmp"/>
	

	<bean type="org.apache.struts2.views.TagLibrary" name="n4" class="com.n4systems.uitags.views.N4TagLibrary"/>
	<package name="default" extends="struts-default">

		<interceptors>
			<interceptor name="login" class="com.n4systems.fieldid.utils.LoginInterceptor" />
            <interceptor name="setCurrentUser" class="com.n4systems.fieldid.utils.SetCurrentUserInterceptor" />
			<interceptor name="enabledFeatures" class="com.n4systems.fieldid.permissions.ExtendedFeatureInterceptor" />
			<interceptor name="userPermissions" class="com.n4systems.fieldid.permissions.UserPermissionInterceptor" />
			<interceptor name="security" class="com.n4systems.fieldid.security.SecurityInterceptor" />
			<interceptor name="flashScope" class="com.n4systems.fieldid.utils.FlashScopeInterceptor" />
			<interceptor name="tenatRequired" class="com.n4systems.fieldid.utils.RequiredTenantInterceptor" />
			<interceptor name="missingEntity" class="com.n4systems.fieldid.utils.MissingEntityInterceptor" />
			<interceptor name="forceNonBranded" class="com.n4systems.fieldid.utils.NonBrandedInterceptor"/>
			<interceptor name="safetyNetworkAware" class="com.n4systems.fieldid.security.SafetyNetworkAwareInterceptor"/>
			<interceptor name="eulaRequired" class="com.n4systems.fieldid.utils.EULAInterceptor"/>
			<interceptor name="setupWizard" class="com.n4systems.fieldid.utils.SetupWizardFirstTimeInterceptor"/>
			<interceptor name="concurrentSession" class="com.n4systems.fieldid.utils.ConcurrentSessionInterceptor"/>
			
			<interceptor-stack name="publicStack">
				<interceptor-ref name="paramsPrepareParamsStack" />
				<interceptor-ref name="missingEntity" />
			</interceptor-stack>
			
			<interceptor-stack name="brandedPublicStack">
				<interceptor-ref name="tenatRequired" />
				<interceptor-ref name="publicStack" />
				<interceptor-ref name="enabledFeatures"/>
			</interceptor-stack>
			
			<interceptor-stack name="loggedInStack">
				<interceptor-ref name="tenatRequired" />
				<interceptor-ref name="login" />
				<interceptor-ref name="concurrentSession"/>
                <interceptor-ref name="setCurrentUser" />
				<interceptor-ref name="security" />
				<interceptor-ref name="safetyNetworkAware"/>
				<interceptor-ref name="publicStack" />
				<interceptor-ref name="enabledFeatures"/>
				<interceptor-ref name="userPermissions"/>
			</interceptor-stack>
			
			<interceptor-stack name="secureStack">
				<interceptor-ref name="loggedInStack" />
				<interceptor-ref name="eulaRequired" />
			</interceptor-stack>

			<interceptor-stack name="flashSecureStack">
				<interceptor-ref name="flashScope" />
				<interceptor-ref name="secureStack" />
			</interceptor-stack>
			
			
			<interceptor-stack name="nonBrandedFlashStack">
				<interceptor-ref name="forceNonBranded" />
				<interceptor-ref name="flashScope" />
				<interceptor-ref name="publicStack" />
			</interceptor-stack>
			
			
			<interceptor-stack name="brandedFlashPublicStack">
				<interceptor-ref name="flashScope" />
				<interceptor-ref name="brandedPublicStack" />
			</interceptor-stack>
			
			<interceptor-stack name="homeStack">
				<interceptor-ref name="flashSecureStack"/>
				<interceptor-ref name="setupWizard"/>
			</interceptor-stack>

		</interceptors>

		<default-interceptor-ref name="flashSecureStack" />

		<global-results>
			<result name="sessionBooted" type="redirectAction">
				<param name="namespace">/</param>
				<param name="actionName">booted</param>
			</result>
			<result name="login" type="redirectAction">login</result>
			<result name="require_eula" type="redirectAction">
				<param name="actionName">eulaAcceptanceAdd</param>
            	<param name="namespace">/</param>
			</result>
			<result name="tenant_missing" type="redirectAction">
				<param name="actionName">chooseCompany</param>
            	<param name="namespace">/</param>
				<param name="tenantNotFound">true</param>
			</result>
			<result name="feature_required" type="freemarker">/templates/html/common/featureRequired.ftl</result>
			<result name="user_permission_required" type="freemarker">/templates/html/common/userPermissionRequired.ftl</result>
			
			<result name="redirect_to_url" type="redirect">
				<param name="location">${redirectUrl}</param>
			</result>
			
			<result name="startSetupWizard" type="redirectAction">
				<param name="namespace">/quickSetupWizard</param>
				<param name="actionName">startWizard</param>
			</result>
		</global-results>
	</package>

	<package name="embedded" extends="default" namespace="/embedded">
		<action name="login" method="add" class="com.n4systems.fieldid.actions.LoginAction" >
			<interceptor-ref name="brandedFlashPublicStack" />
			<result name="success" type="freemarker">/templates/html/login/embedded.ftl</result>
			<result name="alreadyLoggedIn" type="freemarker">/templates/html/login/embedded.ftl</result>
		</action>
	</package>

	<include file="publicWebPackageStruts.xml"/>
	<include file="webPackageStruts.xml"/>
	
	<include file="ajaxPackageStruts.xml"/>
	<include file="aHtmlPackageStruts.xml"/>
	<include file="quickSetupWizardPackage.xml"/>
	<include file="multiEventPackageStruts.xml"/>
	<include file="adminPackageStruts.xml"/>
	
	<package name="external" extends="default" namespace="/external/ajax">
		<default-interceptor-ref name="secureStack" />

		<global-results>
			<result name="login" type="freemarker">/templates/external/ajax/common/signed_out.ftl</result>
			<result name="error" type="freemarker">/templates/external/ajax/common/error.ftl</result>
			<result name="missing" type="freemarker">/templates/external/ajax/common/error.ftl</result>
			<result name="input" type="freemarker">/templates/external/ajax/common/error.ftl</result>
			<result name="invalid_security" type="freemarker">/templates/external/ajax/common/error.ftl</result>
			<result name="feature_required" type="freemarker">/templates/external/ajax/common/error.ftl</result>
			<result name="user_permission_required" type="freemarker">/templates/external/ajax/common/error.ftl</result>
			<result name="tenant_missing" type="freemarker">/templates/external/ajax/common/error.ftl</result>
			<result name="sessionBooted" type="freemarker">/templates/external/ajax/common/session_kicked.ftl</result>
		</global-results>

	</package>
	<package name="files" extends="default" namespace="/file">
		<global-results>
			<result name="success" type="stream">
				<param name="contentType">${contentType}</param>
				<param name="inputName">fileStream</param>
				<param name="contentLength">${fileSize}</param>
				<param name="contentDisposition">inline; filename="${fileName}"</param>
			</result>
			<result name="missing" type="httpheader">
				<param name="error">404</param>
			</result>
			<result name="invalid_security" type="httpheader">
				<param name="error">403</param>
			</result>
			<result name="error" type="httpheader">
				<param name="error">404</param>
			</result>
		</global-results>
		<action name="downloadAttachedFile" method="download" class="com.n4systems.fieldid.actions.downloaders.DownloadAttachedEventFile" />
        <action name="downloadAllAttachedFiles" method="downloadAll" class="com.n4systems.fieldid.actions.downloaders.DownloadAttachedEventFile" />
		<action name="downloadSubAttachedFile" method="downloadSubEvent" class="com.n4systems.fieldid.actions.downloaders.DownloadAttachedEventFile" />
		<action name="downloadProofTestChart" method="downloadChart" class="com.n4systems.fieldid.actions.downloaders.DownloadAttachedEventFile" />
		<action name="downloadJobNoteFile" method="download" class="com.n4systems.fieldid.actions.downloaders.DownloadProjectNoteFile" />
        <action name="downloadEventCert" method="download" class="com.n4systems.fieldid.actions.downloaders.DownloadEventCert" />
		<action name="downloadAssetTypeAttachedFile" method="download" class="com.n4systems.fieldid.actions.downloaders.DownloadAssetTypeAttachedFile" />
		<action name="downloadAssetTypeAttachedFileSafetyNetwork" method="download" class="com.n4systems.fieldid.actions.downloaders.DownloadSafetyNetworkAssetTypeAttachedFile" />
		<action name="downloadAssetTypeImage" method="download" class="com.n4systems.fieldid.actions.downloaders.DownloadAssetTypeImage" />
		
		<action name="downloadAssetTypeImageSafetyNetwork" method="download" class="com.n4systems.fieldid.actions.downloaders.DownloadSafetyNetworkAssetTypeImage" />
		<action name="downloadPrintOutPreview" method="download" class="com.n4systems.fieldid.actions.downloaders.DownloadPrintOutPreview" />
		<action name="downloadPrintOutThumb" method="downloadThumb" class="com.n4systems.fieldid.actions.downloaders.DownloadPrintOutPreview" />
		<action name="downloadAssetAttachedFile" method="download" class="com.n4systems.fieldid.actions.downloaders.DownloadAssetAttachmentFile" />
		<action name="downloadAssetImage" method="download" class="com.n4systems.fieldid.actions.downloaders.DownloadAssetImage" />
		<action name="downloadAssetAttachedFileSafetyNetwork" method="download" class="com.n4systems.fieldid.actions.downloaders.DownloadSafetyNetworkAssetAttachmentFile" />
		<action name="downloadExampleCustomerExport" method="download" class="com.n4systems.fieldid.actions.customers.ExampleCustomerExportAction" />
		<action name="downloadExampleAutoAttributeExport" method="downloadExample" class="com.n4systems.fieldid.actions.autoattribute.AutoAttributeExportAction" />
		<action name="downloadExampleAssetExport" method="downloadExample" class="com.n4systems.fieldid.actions.asset.AssetImportAction" />
		<action name="downloadExampleEventExport" method="downloadExample" class="com.n4systems.fieldid.actions.event.EventImportAction" />
		<action name="downloadUserSignature" method="download" class="com.n4systems.fieldid.actions.downloaders.DownloadUserSignature" />		
		<action name="downloadExampleUserExport" method="download" class="com.n4systems.fieldid.actions.users.ExampleUserExportAction" />



        <action name="downloadTemporarySignature" method="downloadTemporary" class="com.n4systems.fieldid.actions.signature.SignatureAction" />
        <action name="downloadSignature" method="download" class="com.n4systems.fieldid.actions.signature.SignatureAction" />

        <action name="downloadManufacturerCert" method="download" class="com.n4systems.fieldid.actions.downloaders.DownloadManufacturerCert" >
			<result name="cantprint" type="httpheader"><param name="error">404</param></result>
		</action>
		<action name="downloadLinkedManufacturerCert" method="downloadLinked" class="com.n4systems.fieldid.actions.downloaders.DownloadManufacturerCert" >
			<result name="cantprint" type="httpheader"><param name="error">404</param></result>
		</action>
        <action name="downloadSafetyNetworkManufacturerCert" method="downloadSafetyNetwork" class="com.n4systems.fieldid.actions.downloaders.DownloadManufacturerCert" >
            <result name="cantprint" type="httpheader"><param name="error">404</param></result>
        </action>
		<action name="currentEula" method="show" class="com.n4systems.fieldid.actions.eula.CurrentEulaAction" >
			<interceptor-ref name="loggedInStack" />
			<result name="success" type="freemarker">/templates/html/currentEula/show.ftl</result>
		</action>
		
	</package>
</struts>
